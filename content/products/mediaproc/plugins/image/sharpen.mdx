# Sharpen

Sharpen images to enhance details and edges. Perfect for improving slightly blurry photos or enhancing image clarity.

## Installation

<Install
  package="@mediaproc/image"
  title="To install the Image plugin:"
  global
/>

## Usage

<Terminal
  commands={[{ command: "mediaproc image sharpen <input> [options]" }]}
/>

### Basic Usage

<Terminal
  commands={[
    { command: "mediaproc image sharpen photo.jpg" },
    { output: "✓ Sharpened (sigma: 1.0)", isSuccess: true },
  ]}
/>

<Terminal
  commands={[
    { command: "mediaproc image sharpen image.png -s 2" },
    { output: "✓ Strong sharpening applied", isSuccess: true },
  ]}
/>

<InlineTerminal command="mediaproc image sharpen photo.jpg -s 0.5" />
<InlineTerminal command="mediaproc image sharpen image.jpg -s 1.5 --flat 1.5 --jagged 2.5" />
<InlineTerminal command="mediaproc image sharpen photo.jpg -s 1.2 -q 95" />

## Options

| --------------------- | ----- | ------- | ------------------------- | --------------------------------- |
| `--sigma <value>`     | `-s`  | number  | `1`                       | Sharpening strength (0.01-10)     |
| `--flat <value>`      |       | number  | `1`                       | Sharpening level for flat areas   |
| `--jagged <value>`    |       | number  | `2`                       | Sharpening level for jagged areas |
| `--output <path>`     | `-o`  | string  | `<input>-sharpened.<ext>` | Output file path                  |
| `--dry-run`           |       | boolean | `false`                   | Preview without making changes    |
| `--verbose`           | `-v`  | boolean | `false`                   | Show detailed output              |
| `--help`              |       | boolean | `false`                   | Display help information          |
| Option                | Alias | Type    | Default                   | Description                       |
| --------------------- | ----- | ------- | ------------------------- | --------------------------------- |
| `--sigma <value>`     | `-s`  | number  | `1`                       | Sharpening strength (0.01-10)     |
| `--flat <value>`      |       | number  | `1`                       | Sharpening level for flat areas   |
| `--jagged <value>`    |       | number  | `2`                       | Sharpening level for jagged areas |
| `--quality <value>`   | `-q`  | number  | —                         | Output quality (optional; only for JPEG, WEBP, AVIF; mapped to compressionLevel for PNG; ignored for other formats) |
| `--output <path>`     | `-o`  | string  | `<input>-sharpened.<ext>` | Output file path                  |
| `--dry-run`           |       | boolean | `false`                   | Preview without making changes    |
| `--verbose`           | `-v`  | boolean | `false`                   | Show detailed output              |
| `--help`              |       | boolean | `false`                   | Display help information          |

## Sharpening Parameters

### Sigma (Strength)

Controls overall sharpening intensity:

**0.3-0.7**: Subtle enhancement

- Gentle sharpening
- Natural appearance
- Good for already sharp images

**1.0-1.5**: Normal sharpening (Recommended)

- Standard enhancement
- Balanced results
- Default: 1.0

**2.0-3.0**: Strong sharpening

- Heavy enhancement
- Noticeable effect
- Risk of halos if overdone

**3.0+**: Extreme sharpening

- Very strong effect
- High risk of artifacts
- Use with caution

### Flat

Sharpening applied to smooth, flat areas:

- **Lower values** (0.5-1): Less sharpening in flat areas
- **Default**: 1
- **Higher values** (1.5-2): More sharpening in flat areas

### Jagged

Sharpening applied to edges and jagged areas:

- **Lower values** (1-1.5): Gentler edge enhancement
- **Default**: 2
- **Higher values** (2.5-3): Stronger edge enhancement

## Sharpening Guide

### Subtle Sharpening

Gentle enhancement:

```bash
# Sigma: 0.3-0.7
mediaproc image sharpen photo.jpg -s 0.5
```

**Use for**: Already good images, portraits, natural photos.

### Normal Sharpening

Standard enhancement:

```bash
# Sigma: 1.0-1.5
mediaproc image sharpen image.jpg -s 1.2
```

**Use for**: General photography, web images, prints.

### Strong Sharpening

Heavy enhancement:

```bash
# Sigma: 2.0-3.0
mediaproc image sharpen photo.jpg -s 2.5
```

**Use for**: Very soft images, landscapes, architecture.

### Custom Sharpening

Fine-tuned control:

```bash
# Custom flat and jagged
mediaproc image sharpen image.jpg -s 1.5 --flat 1 --jagged 2.5
```

**Use for**: Specific requirements, experimentation.

## Examples

### 1. Default Sharpening

Apply standard sharpening:

```bash
mediaproc image sharpen photo.jpg
```

**Result**: Sigma 1, balanced enhancement.

### 2. Strong Sharpening

Heavy enhancement for soft images:

```bash
mediaproc image sharpen soft-image.jpg -s 2
```

**Use**: Very blurry or soft images.

### 3. Subtle Enhancement

Gentle sharpening:

```bash
mediaproc image sharpen good-photo.jpg -s 0.5
```

**Use**: Already sharp images, subtle boost.

### 4. Portrait Sharpening

Careful portrait enhancement:

```bash
mediaproc image sharpen portrait.jpg -s 0.7 --flat 0.5 --jagged 1.5
```

**Portraits**: Enhance details without harsh edges.

### 5. Landscape Sharpening

Strong landscape enhancement:

```bash
mediaproc image sharpen landscape.jpg -s 1.8 --jagged 2.5
```

**Landscapes**: Enhance details and edges.

### 6. Architecture Photography

Sharpen building details:

```bash
mediaproc image sharpen building.jpg -s 2 --jagged 3
```

**Architecture**: Crisp edges and details.

### 7. Batch Sharpening

Sharpen multiple images:

```bash
mediaproc image sharpen "photos/*.jpg" -s 1.2
```

**Batch**: Consistent enhancement.

### 8. High Quality Output

Maximum quality sharpening:

```bash
mediaproc image sharpen photo.jpg -s 1.5 -q 100
```

**Print**: No quality loss.

### 9. Comparison Tests

Test different strengths:

```bash
# Subtle
mediaproc image sharpen photo.jpg -s 0.5 -o subtle.jpg

# Normal
mediaproc image sharpen photo.jpg -s 1 -o normal.jpg

# Strong
mediaproc image sharpen photo.jpg -s 2 -o strong.jpg
```

**Testing**: Find optimal strength.


## Output Formats and Quality Flag

The `--quality` flag is **optional** and only affects JPEG, WEBP, and AVIF outputs. For PNG, it is mapped to `compressionLevel`. For all other formats, the flag is ignored. If not specified, the encoder's default quality is used.

---

### 10. Web Image Sharpening

Enhance for web display:

```bash
mediaproc image sharpen web-image.jpg -s 1.2 -q 85
```

**Web**: Good sharpness, reasonable file size.

### 11. Product Photography

Sharpen product details:

```bash
mediaproc image sharpen product.jpg -s 1.5 --jagged 2.5 -q 95
```

**E-commerce**: Clear product details.

### 12. Scanned Documents

Enhance scanned text:

```bash
mediaproc image sharpen scan.jpg -s 2.5 --jagged 3
```

**Documents**: Crisp text and lines.

### 13. Macro Photography

Enhance fine details:

```bash
mediaproc image sharpen macro.jpg -s 1.8 --flat 1.5 --jagged 2.5
```

**Macro**: Intricate detail enhancement.

### 14. Verbose Output

Show processing info:

```bash
mediaproc image sharpen photo.jpg -s 1.5 --verbose
```

**Info**: Processing details, dimensions.

### 15. Preview Before Sharpening

Check settings:

```bash
mediaproc image sharpen image.jpg -s 2 --dry-run
```

**Safety**: Verify before processing.

## Use Cases

### 1. Correct Slightly Blurry Photos

Fix minor blur issues:

```bash
# Camera shake
mediaproc image sharpen blurry.jpg -s 1.5

# Focus issues
mediaproc image sharpen soft-focus.jpg -s 1.8
```

**Photography**: Salvage soft photos.

### 2. Enhance After Resizing

Sharpen after downsizing:

```bash
# Resize
mediaproc image resize large.jpg -w 1200 -o resized.jpg

# Sharpen
mediaproc image sharpen resized.jpg -s 1.2
```

**Workflow**: Restore sharpness after resize.

### 3. Web Image Preparation

Prepare sharp web images:

```bash
# Optimize and sharpen
mediaproc image sharpen photo.jpg -s 1.2 -q 85 -o web.jpg
```

**Web**: Clear, optimized images.

### 4. Print Preparation

Enhance for print output:

```bash
# Print sharpening
mediaproc image sharpen photo.jpg -s 1.5 -q 95
```

**Print**: Professional print quality.

### 5. Product Photography

E-commerce product enhancement:

```bash
# Sharpen details
mediaproc image sharpen "products/*.jpg" -s 1.5 --jagged 2.5
```

**E-commerce**: Clear product images.

### 6. Document Scanning

Enhance scanned documents:

```bash
# Sharpen text and diagrams
mediaproc image sharpen scan.jpg -s 2.5
```

**Documents**: Readable scans.

### 7. Social Media

Prepare eye-catching posts:

```bash
# Social media sharpening
mediaproc image sharpen post.jpg -s 1.3 -q 90
```

**Social**: Crisp social media images.

### 8. Portrait Enhancement

Careful portrait sharpening:

```bash
# Enhance eyes and details
mediaproc image sharpen portrait.jpg -s 0.8 --flat 0.5
```

**Portraits**: Natural enhancement.

### 9. Landscape Photography

Dramatic landscape enhancement:

```bash
# Strong landscape sharpening
mediaproc image sharpen landscape.jpg -s 1.8 --jagged 2.5
```

**Landscapes**: Enhanced details and textures.

### 10. Macro Photography

Enhance fine details:

```bash
# Macro detail enhancement
mediaproc image sharpen macro.jpg -s 1.7 --jagged 2.8
```

**Macro**: Intricate detail clarity.

## Combining with Other Commands

### Resize + Sharpen

Standard workflow:

```bash
# Resize
mediaproc image resize large.jpg -w 1920 -o resized.jpg

# Sharpen to recover detail
mediaproc image sharpen resized.jpg -s 1.2
```

**Best Practice**: Always sharpen after resizing.

### Auto-Enhance + Sharpen

Complete enhancement:

```bash
# Auto enhance
mediaproc image auto-enhance photo.jpg -o enhanced.jpg

# Sharpen
mediaproc image sharpen enhanced.jpg -s 1
```

**Workflow**: Comprehensive improvement.

### Blur + Sharpen

Selective focus simulation:

```bash
# Blur background
mediaproc image blur background.jpg -s 5 -o blurred.jpg

# Sharpen subject (requires masking)
# Manual workflow needed
```

**Advanced**: Bokeh simulation.

### Sharpen + Optimize

Prepare for web:

```bash
# Sharpen
mediaproc image sharpen photo.jpg -s 1.2 -o sharp.jpg

# Optimize file size
mediaproc image optimize sharp.jpg -q 85
```

**Web Workflow**: Sharp, optimized images.

## Technical Details

### Sharpening Algorithm

Uses unsharp mask technique:

1. **Gaussian blur**: Creates blurred version
2. **Subtract**: Finds difference (edges)
3. **Add back**: Enhances edges in original

### Sigma Parameter

Controls Gaussian blur radius:

- Larger sigma = stronger sharpening
- Too large = halos and artifacts
- Optimal: 0.5-2 for most images

### Flat vs Jagged

**Flat (m1)**: Controls sharpening in uniform areas
**Jagged (m2)**: Controls sharpening at edges

Formula: `output = original + (original - blurred) × threshold`

### Performance

- **Fast**: Gaussian blur + addition
- **Small images (less than 1MP)**: ~80-120ms
- **Medium images (5MP)**: ~200-300ms
- **Large images (greater than 10MP)**: ~400-600ms
- Larger sigma = slightly slower

### Artifacts to Watch For

**Halos**: Bright edges around dark objects

- Cause: Too much sharpening
- Solution: Reduce sigma

**Noise amplification**: Grainy appearance

- Cause: Sharpening noisy images
- Solution: Denoise first

**Edge ringing**: Oscillations near edges

- Cause: Extreme sharpening
- Solution: Lower sigma, adjust flat/jagged

## Best Practices

### 1. Sharpen Last in Workflow

Always sharpen as final step:

```bash
# Wrong order
mediaproc image sharpen photo.jpg -o sharp.jpg
mediaproc image resize sharp.jpg -w 1200

# Correct order
mediaproc image resize photo.jpg -w 1200 -o resized.jpg
mediaproc image sharpen resized.jpg -s 1.2
```

### 2. Use Lower Values for Portraits

Avoid harsh skin texture:

```bash
# Portraits (0.5-1)
mediaproc image sharpen portrait.jpg -s 0.7
```

### 3. Use Higher Values for Landscapes

Enhance texture and detail:

```bash
# Landscapes (1.5-2.5)
mediaproc image sharpen landscape.jpg -s 1.8
```

### 4. Test Before Batch Processing

Find optimal settings on sample:

```bash
# Test on one image
mediaproc image sharpen sample.jpg -s 1.5 -o test.jpg

# If good, process batch
mediaproc image sharpen "photos/*.jpg" -s 1.5
```

### 5. Don't Over-Sharpen

Too much sharpening looks artificial:

```bash
# Too much (artifacts)
mediaproc image sharpen photo.jpg -s 5

# Appropriate
mediaproc image sharpen photo.jpg -s 1.5
```

### 6. Quality Settings Matter

Use appropriate quality:

```bash
# Web (80-90)
mediaproc image sharpen photo.jpg -s 1.2 -q 85

# Print (95-100)
mediaproc image sharpen photo.jpg -s 1.5 -q 95
```

### 7. Adjust for Image Type

**Portraits**: Lower sigma, lower flat
**Landscapes**: Higher sigma, higher jagged
**Products**: Medium-high sigma
**Documents**: High sigma, high jagged

## Troubleshooting

### Issue: Halos Around Objects

**Problem**: Bright edges around dark objects

**Cause**: Too much sharpening

**Solution**: Reduce sigma

```bash
# Halos present
mediaproc image sharpen photo.jpg -s 3

# Better
mediaproc image sharpen photo.jpg -s 1.2
```

### Issue: Image Looks Grainy

**Problem**: Noise amplified

**Cause**: Sharpening noisy image

**Solution**: Denoise first or reduce sigma

```bash
# Reduce sigma
mediaproc image sharpen noisy.jpg -s 0.7
```

### Issue: No Visible Effect

**Problem**: Sharpening not noticeable

**Cause**: Sigma too low or image already sharp

**Solution**: Increase sigma

```bash
# Not visible
mediaproc image sharpen photo.jpg -s 0.1

# More visible
mediaproc image sharpen photo.jpg -s 1.5
```

### Issue: Looks Artificial

**Problem**: Over-sharpened appearance

**Cause**: Sigma too high

**Solution**: Reduce to natural range

```bash
# Artificial
mediaproc image sharpen photo.jpg -s 4

# Natural
mediaproc image sharpen photo.jpg -s 1.2
```

### Issue: Edges Look Wrong

**Problem**: Strange edge artifacts

**Cause**: Jagged parameter too high

**Solution**: Reduce jagged value

```bash
# Too much edge sharpening
mediaproc image sharpen photo.jpg -s 2 --jagged 5

# Better
mediaproc image sharpen photo.jpg -s 2 --jagged 2
```

## Related Commands

- [blur](./blur.mdx) - Opposite effect (soften images)
- [auto-enhance](./auto-enhance.mdx) - Automatic enhancement including sharpening
- [resize](./resize.mdx) - Resize images (sharpen after)
- [convolve](./convolve.mdx) - Custom sharpening kernels

## Further Reading

- [Unsharp Masking](https://en.wikipedia.org/wiki/Unsharp_masking)
- [Image Sharpening](https://en.wikipedia.org/wiki/Image_sharpening)
- [Gaussian Blur](https://en.wikipedia.org/wiki/Gaussian_blur)
