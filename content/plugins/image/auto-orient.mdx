# auto-orient

Automatically rotate images based on EXIF orientation metadata to correct camera rotation.

## Usage

```bash
mediaproc image auto-orient <input> [options]
# or using alias
mediaproc image rotate-auto <input> [options]
```

## Description

The `auto-orient` command reads EXIF orientation metadata from images and rotates them to the correct orientation. This is essential for photos taken with cameras or smartphones that were held vertically or at an angle. The command automatically detects the orientation tag and applies the appropriate rotation and/or flip.

After correction, the EXIF orientation tag is removed since the pixels are now properly oriented.

## Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `-o, --output` | path | `<input>-oriented.<ext>` | Output file path |
| `-q, --quality` | number | 90 | Output quality (1-100) |
| `--dry-run` | flag | - | Preview changes without executing |
| `-v, --verbose` | flag | - | Show detailed output |

## EXIF Orientation Values

The EXIF orientation tag can have these values:

| Value | Rotation | Flip | Description |
|-------|----------|------|-------------|
| 1 | None | None | Normal (no correction needed) |
| 2 | None | Horizontal | Flipped horizontally |
| 3 | 180° | None | Rotated 180 degrees |
| 4 | 180° | Horizontal | Rotated 180° and flipped |
| 5 | 90° CW | Horizontal | Rotated 90° clockwise and flipped |
| 6 | 90° CW | None | Rotated 90° clockwise (vertical photo) |
| 7 | 90° CCW | Horizontal | Rotated 90° counter-clockwise and flipped |
| 8 | 90° CCW | None | Rotated 90° counter-clockwise |

The `auto-orient` command automatically handles all these cases.

## Examples

### Basic Usage

```bash
# Fix single image orientation
mediaproc image auto-orient photo.jpg

# Using alias
mediaproc image rotate-auto portrait.jpg

# Custom output path
mediaproc image auto-orient IMG_1234.jpg -o corrected.jpg
```

### Batch Processing

```bash
# Fix all JPGs in directory
mediaproc image auto-orient "photos/*.jpg"

# Fix all images with verbose output
mediaproc image auto-orient "images/*" -v

# Preview what would be done
mediaproc image auto-orient "batch/*.jpg" --dry-run
```

### Smartphone Photos

```bash
# Fix iPhone photos
mediaproc image auto-orient "iPhone/*.HEIC"

# Fix Android photos
mediaproc image auto-orient "DCIM/*.jpg"

# Process entire camera roll
mediaproc image auto-orient "CameraRoll/**/*.jpg" -v
```

### Specific Quality

```bash
# High quality output
mediaproc image auto-orient photo.jpg -q 95 -o fixed.jpg

# Medium quality for web
mediaproc image auto-orient image.jpg -q 85

# Lower quality to save space
mediaproc image auto-orient large.jpg -q 75 -o compressed.jpg
```

### Integration with Other Commands

```bash
# Fix orientation then resize
mediaproc image auto-orient photo.jpg -o temp.jpg
mediaproc image resize temp.jpg -w 1920 -o final.jpg

# Fix orientation and optimize
mediaproc image auto-orient image.jpg
mediaproc image optimize image-oriented.jpg
```

## Common Use Cases

### Camera Import Workflow

```bash
# Step 1: Import photos from camera/phone
# Step 2: Fix all orientations
mediaproc image auto-orient "imports/*.jpg" -v

# Step 3: Continue with other processing
```

### Web Upload Preparation

```bash
# Ensure correct orientation for web display
mediaproc image auto-orient upload.jpg -o web-ready.jpg -q 85
```

### Photo Organization

```bash
# Fix orientation before organizing
for img in unsorted/*.jpg; do
  mediaproc image auto-orient "$img"
done
```

### Backup Preparation

```bash
# Correct orientation before backing up
mediaproc image auto-orient "photos/**/*.jpg" -v
```

## Why This Matters

### Problem Without Auto-Orient

When you take photos with a smartphone or camera held vertically:
- The image pixels are saved in landscape orientation
- An EXIF tag records the camera was rotated
- Many programs read this tag and display correctly
- But some software (web browsers, older apps) ignores EXIF
- Result: Your vertical photos appear sideways

### Solution With Auto-Orient

The command actually rotates the image pixels:
- Reads EXIF orientation tag
- Physically rotates/flips the image data
- Removes the EXIF orientation tag
- Result: Image displays correctly everywhere

## Best Practices

1. **Run Early in Workflow**: Fix orientation before other processing
2. **Batch Process Imports**: Always run on new photo imports
3. **Keep Originals**: Use custom output or backup first
4. **Check Quality**: Use -q 95+ for important photos
5. **Use Dry-Run**: Preview changes on large batches
6. **Verbose Mode**: Use -v for troubleshooting

## Performance Tips

- Auto-orient is very fast (simple rotation/flip)
- Process hundreds of images quickly
- No need to check orientation first (safe to run on all images)
- Combine with other processing for efficiency

## Safe to Run Multiple Times

The command is idempotent and safe:
- Images with no EXIF orientation (value 1) are unchanged
- Already-oriented images won't be re-rotated
- Safe to run on entire directories without checking

## Supported Formats

Works with all common image formats that support EXIF:
- **JPEG/JPG**: Full EXIF support (most common)
- **TIFF**: EXIF supported
- **HEIC/HEIF**: Modern iPhone format with EXIF
- **PNG**: Limited EXIF support (not common)
- **WebP**: Can contain EXIF data

Note: PNG and WebP rarely have EXIF orientation tags.

## What Happens to EXIF Data

- **Orientation tag**: Removed (set to 1 after correction)
- **Other EXIF data**: Preserved (camera model, date, location, etc.)
- **Image quality**: Maintained based on -q setting

## Comparison with Manual Rotation

**Without auto-orient** (manual approach):
1. Check EXIF orientation
2. Calculate needed rotation
3. Manually rotate
4. Remove EXIF tag

**With auto-orient** (automatic):
```bash
mediaproc image auto-orient photo.jpg
```

Much simpler and error-free!

## Troubleshooting

**Image not rotated:**
- Check if image has EXIF data: `exiftool image.jpg`
- Some images may already have orientation 1 (correct)
- Verify file has EXIF orientation tag

**Image rotated wrong direction:**
- This shouldn't happen with standard EXIF values
- If it does, the EXIF tag may be incorrect
- Try manual rotation instead

**Loss of quality:**
- Increase quality setting: `-q 95`
- Use lossless formats (PNG)
- Note: JPEG rotation always reencodes

**Batch taking long time:**
- This is normal for large batches
- Use `-v` to see progress
- Consider parallel processing for thousands of images

## Advanced Usage

### Selective Processing

```bash
# Only process images that need rotation (check EXIF first)
# Future feature - currently processes all files
```

### Format Conversion During Orient

```bash
# Fix orientation and convert format
mediaproc image auto-orient photo.HEIC -o corrected.jpg
```

### Integration with Scripts

```bash
#!/bin/bash
# Auto-orient all new photos
find ~/Photos -name "*.jpg" -mtime -1 | while read img; do
  mediaproc image auto-orient "$img" -v
done
```

## Future Enhancements

*These features are planned but not yet implemented:*

- **--preserve-exif**: Keep all EXIF data including orientation tag (FUTURE)
- **--check-only**: Report orientation without processing (FUTURE)
- **--force**: Re-orient already corrected images (FUTURE)
- **--remove-exif-all**: Strip all EXIF data during orient (FUTURE)

## See Also

- [rotate](./rotate) - Manual rotation by degrees
- [flip](./flip) - Flip horizontally
- [flop](./flop) - Flip vertically
- [metadata-cmd](./metadata-cmd) - View/edit EXIF data
- [optimize](./optimize) - Optimize file size after orientation
