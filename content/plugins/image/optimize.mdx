# Optimize

Optimize image file size with minimal quality loss. Perfect for web optimization, faster loading times, reduced storage costs, and bandwidth savings while maintaining visual quality.

## Installation

<Install package="@mediaproc/image" title="To install the Image plugin:" global={true} />

## Usage

<Terminal commands={[{ command: 'mediaproc image optimize <input> [options]' }]} />

### Basic Usage

<Terminal commands={[
  { command: 'mediaproc image optimize photo.jpg' },
  { output: '✓ Optimized • 2.4 MB → 1.8 MB (25% reduction)', isSuccess: true }
]} />

<Terminal commands={[
  { command: 'mediaproc image optimize image.png -q 90' },
  { output: '✓ Optimized • 845 KB → 712 KB (16% reduction)', isSuccess: true }
]} />

<Terminal commands={[
  { command: 'mediaproc image optimize pic.jpg --aggressive' },
  { output: '✓ Optimized • 3.2 MB → 1.1 MB (66% reduction)', isSuccess: true }
]} />

<InlineTerminal command="mediaproc image optimize photo.webp -q 80" />

<InlineTerminal command="mediaproc image optimize photo.jpg --dry-run" />

## Options

| Option                | Alias | Type    | Default                   | Description                               |
| --------------------- | ----- | ------- | ------------------------- | ----------------------------------------- |
| `--output <path>`     | `-o`  | string  | `<input>-optimized.<ext>` | Output file path                          |
| `--quality <quality>` | `-q`  | number  | `85`                      | Quality level (1-100)                     |
| `--aggressive`        |       | boolean | `false`                   | Aggressive compression (quality 70)       |
| `--dry-run`           |       | boolean | `false`                   | Show what would be done without executing |
| `--verbose`           | `-v`  | boolean | `false`                   | Show detailed processing information      |
| `--help`              |       | boolean | `false`                   | Display help information                  |

## Quality Guide

<Callout type="tip" title="Choosing the Right Quality Level">

For most web use cases, quality 85 provides the best balance between file size and visual quality. Use quality 90+ for hero images or when quality is critical. For thumbnails or background images, quality 70-80 is often sufficient.

</Callout>

### Quality Levels

- **90-100**: Minimal compression, large files, near-lossless
- **85-89**: Balanced (recommended for web) - default
- **70-84**: Good compression, slight quality loss
- **50-69**: High compression, noticeable quality loss
- **1-49**: Maximum compression, significant artifacts

### Aggressive Mode

When `--aggressive` flag is used:

- Quality set to 70
- Maximum compression applied
- Metadata stripped
- Best for thumbnails and previews

## Optimization Techniques

### JPEG Optimization

<Terminal commands={[
  { command: 'mediaproc image optimize photo.jpg -q 85' },
  { output: '✓ Progressive JPEG enabled', isSuccess: true },
  { output: '✓ MozJPEG compression applied', isSuccess: true },
  { output: '✓ Metadata stripped', isSuccess: true },
  { output: '✓ Optimized: 2.4 MB → 1.6 MB (33% reduction)', isSuccess: true }
]} />

**Techniques Applied:**

- Progressive JPEG encoding
- MozJPEG compression (better than standard JPEG)
- Metadata removal (EXIF, IPTC)
- Optimized Huffman tables
- Chroma subsampling

### PNG Optimization

```bash
mediaproc image optimize image.png -q 85
```

**Techniques Applied:**

- Maximum compression level (9)
- Progressive rendering
- Metadata removal
- Maximum optimization effort (10)
- Palette optimization for indexed colors

### WebP Optimization

```bash
mediaproc image optimize modern.webp -q 85
```

**Techniques Applied:**

- WebP-specific compression
- Effort level 6 (high quality/size balance)
- Metadata removal
- Smart lossy compression

### AVIF Optimization

```bash
mediaproc image optimize next-gen.avif -q 85
```

**Techniques Applied:**

- AVIF compression (best compression)
- Effort level 9 (maximum quality)
- Metadata removal
- Next-generation codec efficiency

## Examples

### 1. Default Web Optimization

Optimize for web with balanced quality/size:

```bash
mediaproc image optimize website-image.jpg
```

**Result**: ~30-50% size reduction, imperceptible quality loss, outputs `website-image-optimized.jpg`.

### 2. High Quality Optimization

Minimal compression for important images:

```bash
mediaproc image optimize hero-image.jpg -q 90
```

**Effect**: ~20-30% size reduction, virtually no visible quality loss.

### 3. Aggressive Compression

Maximum size reduction for thumbnails:

```bash
mediaproc image optimize thumbnail.jpg --aggressive
```

**Size**: ~60-70% reduction, quality 70, suitable for small previews.

### 4. Custom Quality Level

Fine-tune compression:

```bash
mediaproc image optimize product.jpg -q 80 -o compressed.jpg
```

**Balance**: Good compression with acceptable quality for product photos.

### 5. Batch Web Optimization

Optimize all images for website:

```bash
mediaproc image optimize "website-images/*.jpg"
```

**Output**: Creates `*-optimized.jpg` for each file with consistent compression.

### 6. PNG Optimization

Optimize large PNG files:

```bash
mediaproc image optimize screenshot.png
```

**Effect**: Lossless size reduction through better compression, metadata removal.

### 7. WebP Optimization

Optimize modern WebP images:

```bash
mediaproc image optimize banner.webp -q 85
```

**Modern**: WebP already efficient, further optimized with smart compression.

### 8. Social Media Optimization

Optimize for social media upload:

```bash
mediaproc image optimize social-post.jpg -q 80
```

**Fast Upload**: Smaller files upload faster to social platforms.

### 9. Email Optimization

Reduce size for email attachments:

```bash
mediaproc image optimize attachment.jpg -q 75
```

**Email-Friendly**: Small enough for quick sending, good enough for viewing.

### 10. Mobile App Assets

Optimize app images:

```bash
mediaproc image optimize "app-assets/*.png" -q 85
```

**App Size**: Reduced app download size without quality issues.

### 11. Preview Changes

Check optimization before processing:

```bash
mediaproc image optimize large-file.jpg --dry-run
```

**Safety**: Verify operation and output path.

### 12. Portfolio Images

Balance quality and loading speed:

```bash
mediaproc image optimize portfolio-shot.jpg -q 88
```

**Professional**: High quality for portfolio while optimized for web.

### 13. E-commerce Products

Optimize product catalog:

```bash
mediaproc image optimize "products/*.jpg" -q 85
```

**Retail**: Fast page loading without compromising product appearance.

### 14. Blog Images

Optimize blog post images:

```bash
mediaproc image optimize blog-photo.jpg -q 82
```

**Performance**: Faster blog loading, better SEO.

### 15. Verbose Output

See detailed optimization info:

```bash
mediaproc image optimize photo.jpg --verbose
```

**Analysis**: Shows original size, compressed size, percentage saved.

## File Size Reduction

### Expected Savings

**JPEG (Quality 85):**

- Original (Quality 100): 5.2 MB
- Optimized (Quality 85): 1.8 MB
- Savings: ~65%

**PNG:**

- Original (Unoptimized): 3.4 MB
- Optimized (Level 9): 2.1 MB
- Savings: ~38%

**WebP (Quality 85):**

- From JPEG: ~25-35% smaller
- From PNG: ~26-50% smaller

### Quality vs Size

```bash
# Quality 95 - Minimal savings (~20-30%)
mediaproc image optimize photo.jpg -q 95

# Quality 85 - Good savings (~50-60%) - RECOMMENDED
mediaproc image optimize photo.jpg -q 85

# Quality 70 - Max savings (~70-80%)
mediaproc image optimize photo.jpg --aggressive
```

## Format-Specific Optimization

### JPEG

```bash
mediaproc image optimize photo.jpg -q 85
```

**Techniques:**

- Progressive encoding: Loads gradually
- MozJPEG: Superior compression
- Strips EXIF: Removes camera data
- Optimized tables: Better compression ratios

### PNG

```bash
mediaproc image optimize graphic.png -q 85
```

**Techniques:**

- Compression level 9: Maximum lossless compression
- Progressive: Interlaced rendering
- Effort 10: Maximum optimization time
- Strips metadata: Removes unnecessary chunks

### WebP

```bash
mediaproc image optimize modern.webp -q 85
```

**Techniques:**

- Effort 6: Balance between speed and compression
- Smart lossy: Perceptually optimized
- Better than JPEG: ~25% smaller at same quality

### AVIF

```bash
mediaproc image optimize next-gen.avif -q 85
```

**Techniques:**

- Effort 9: Near-maximum compression
- Best compression: ~50% better than JPEG
- Modern browsers: Chrome, Firefox support

## Use Cases

### 1. Website Performance

Speed up website loading:

```bash
mediaproc image optimize "website/*.jpg" -q 85
```

**Benefits:**

- Faster page load
- Better SEO ranking
- Improved user experience
- Reduced bandwidth costs

### 2. Mobile App Size

Reduce app download size:

```bash
mediaproc image optimize "app-assets/*.png"
```

**Impact:**

- Smaller app package
- Faster installation
- Lower cellular data usage

### 3. Email Attachments

Make emails sendable:

```bash
mediaproc image optimize large-photo.jpg -q 75
```

**Result:**

- Under email size limits
- Quick upload/download
- Maintains viewability

### 4. Cloud Storage

Save storage space:

```bash
mediaproc image optimize "cloud-backup/*.jpg"
```

**Savings:**

- Reduced storage costs
- Faster sync times
- More storage capacity

### 5. Social Media

Optimize before uploading:

```bash
mediaproc image optimize instagram-post.jpg -q 80
```

**Advantage:**

- Faster upload
- Preserve quality before platform compression
- Better final appearance

### 6. E-commerce

Optimize product images:

```bash
mediaproc image optimize "products/*.jpg" -q 85
```

**Business Impact:**

- Faster catalog loading
- Better conversion rates
- Lower CDN costs

### 7. Blog/CMS

Optimize content images:

```bash
mediaproc image optimize article-image.jpg -q 82
```

**Publishing:**

- Quick page rendering
- Better reader experience
- SEO benefits

### 8. Photography Portfolio

Balance quality and performance:

```bash
mediaproc image optimize portfolio/*.jpg -q 88
```

**Professional:**

- Show work at high quality
- Fast gallery loading
- Bandwidth savings

### 9. Digital Marketing

Optimize ad creatives:

```bash
mediaproc image optimize ad-banner.jpg -q 80
```

**Marketing:**

- Fast ad loading
- Better ad performance
- Lower hosting costs

### 10. PDF Generation

Optimize images before PDF:

```bash
mediaproc image optimize "report-images/*.jpg" -q 80
```

**Documents:**

- Smaller PDF files
- Easier sharing
- Faster viewing

## Metadata Handling

### Removed Metadata

Optimization strips:

- **EXIF**: Camera settings, GPS location
- **IPTC**: Copyright, keywords
- **XMP**: Adobe metadata
- **ICC Profile**: Color profile (sometimes)

### Preserved Data

Only essential data kept:

- **Orientation**: Image rotation
- **Pixel data**: Image content
- **Format**: File type information

### Privacy Benefits

```bash
# Remove location data automatically
mediaproc image optimize geotagged-photo.jpg
```

**Security**: GPS coordinates and camera info removed.

## Performance Optimization

### Processing Speed

- **JPEG**: Fast (~100-200ms per megapixel)
- **PNG**: Slower (~200-400ms per megapixel, lossless)
- **WebP**: Moderate (~150-300ms per megapixel)
- **AVIF**: Slowest (~500ms+ per megapixel, best compression)

### Batch Processing

```bash
# Process multiple files efficiently
mediaproc image optimize "images/*.jpg"
```

**Efficient**: Sequential processing with automatic memory management.

### Memory Usage

- Small images (under 2MP): ~100MB
- Medium images (2-8MP): ~200-300MB
- Large images (over 8MP): ~300-500MB

## Best Practices

### 1. Choose Right Quality

```bash
# Web images: 80-85
mediaproc image optimize web-image.jpg -q 85

# Thumbnails: 70-75
mediaproc image optimize thumb.jpg -q 70

# Portfolio/Print: 88-92
mediaproc image optimize portfolio.jpg -q 90
```

### 2. Test on Sample

Before batch processing:

```bash
# Test one image
mediaproc image optimize sample.jpg -q 85

# Compare quality
# If good, process all
mediaproc image optimize "all/*.jpg" -q 85
```

### 3. Keep Originals

Always preserve originals:

```bash
# Outputs to new file by default
mediaproc image optimize original.jpg
# Creates: original-optimized.jpg
# Original preserved
```

### 4. Consider Format Conversion

For maximum savings, convert format:

```bash
# Convert PNG to WebP (even better compression)
mediaproc image convert logo.png -f webp -q 85
```

### 5. Use Dry Run

Preview before processing:

```bash
mediaproc image optimize photo.jpg --dry-run
```

### 6. Monitor File Size

Check savings with verbose mode:

```bash
mediaproc image optimize large-file.jpg -q 85 --verbose
```

### 7. Batch Similar Images

Group by type for consistent quality:

```bash
# Photos
mediaproc image optimize "photos/*.jpg" -q 85

# Graphics
mediaproc image optimize "graphics/*.png" -q 88
```

## Troubleshooting

### Issue: Quality Too Low

**Problem**: Output looks worse than expected

**Solution**: Increase quality:

```bash
# Instead of
mediaproc image optimize photo.jpg --aggressive

# Use
mediaproc image optimize photo.jpg -q 85
```

### Issue: Not Enough Savings

**Problem**: File size didn't reduce much

**Possible Causes**:

- Image already optimized
- PNG with minimal redundancy
- Quality setting too high

**Solutions**:

```bash
# Try lower quality
mediaproc image optimize photo.jpg -q 80

# Or aggressive mode
mediaproc image optimize photo.jpg --aggressive

# Or convert format
mediaproc image convert photo.jpg -f webp -q 85
```

### Issue: Slow Processing

**Problem**: Optimization takes too long

**Cause**: Large files, high effort settings

**Solution**: Process in batches, be patient:

```bash
# PNG is slower but worthwhile
mediaproc image optimize large.png
# This is normal, wait for completion
```

### Issue: Output Looks Same

**Problem**: No visible difference after optimization

**Good News**: That's the goal! Check file size:

```bash
mediaproc image optimize photo.jpg --verbose
# Shows: 5.2MB → 1.8MB (65% savings)
```

## Related Commands

- [convert](./convert.mdx) - Convert to more efficient formats (WebP, AVIF)
- [resize](./resize.mdx) - Reduce dimensions for additional savings
- [thumbnail](./thumbnail.mdx) - Create small optimized previews
- [auto-enhance](./auto-enhance.mdx) - Enhance before optimizing

## Further Reading

- [Image Optimization](https://web.dev/fast/#optimize-your-images)
- [WebP Format](https://developers.google.com/speed/webp)
- [AVIF Format](https://jakearchibald.com/2020/avif-has-landed/)
- [MozJPEG](https://github.com/mozilla/mozjpeg)
