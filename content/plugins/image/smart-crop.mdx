# Smart Crop

Intelligent content-aware cropping that automatically preserves important image content. Uses entropy analysis or attention-based focusing to crop images while maintaining visual interest.

## Overview

The smart-crop command uses content analysis to intelligently crop images to specific dimensions:

- **Entropy Strategy**: Analyzes edges and details, preserves high-information areas
- **Attention Strategy**: Center-weighted focus for portraits and centered subjects

Perfect for:

- Social media image preparation
- Product thumbnails
- Blog post featured images
- Profile pictures and avatars
- Website banners and headers
- Mobile app screenshots

Automatically crops to target dimensions while keeping important content in frame.

## Syntax

```bash
mediaproc image smart-crop <input> -w <width> -h <height> [options]
```

## Options

| Option           | Alias | Type    | Default      | Description                                     |
| ---------------- | ----- | ------- | ------------ | ----------------------------------------------- |
| `-w, --width`    |       | number  | **required** | Target width in pixels                          |
| `-h, --height`   |       | number  | **required** | Target height in pixels                         |
| `-s, --strategy` |       | string  | entropy      | Cropping strategy: entropy or attention         |
| `-o, --output`   |       | string  |              | Custom output path (default: input-cropped.ext) |
| `--dry-run`      |       | boolean | false        | Preview without processing                      |
| `-v, --verbose`  |       | boolean | false        | Show detailed processing information            |

## Cropping Strategies

### Entropy Strategy (Default)

Analyzes image details and edges to find high-information areas.

**How it works**:

- Calculates information density across image
- Finds regions with most edges and details
- Preserves areas with highest visual complexity

**Best for**:

- Landscape photos
- Detailed images
- Complex compositions
- Textures and patterns
- Urban scenes
- Nature photography

**Example**:

```bash
mediaproc image smart-crop landscape.jpg -w 1200 -h 630 -s entropy
```

### Attention Strategy

Center-weighted approach that focuses on central subjects.

**How it works**:

- Prioritizes content near image center
- Ideal for centered subjects
- Maintains focus on primary subject

**Best for**:

- Portrait photos
- Centered subjects
- Product photography
- Profile pictures
- Face-focused images
- Centered compositions

**Example**:

```bash
mediaproc image smart-crop portrait.jpg -w 1080 -h 1080 -s attention
```

## Common Dimensions

### Social Media

#### Facebook / LinkedIn

```bash
# Shared post images
mediaproc image smart-crop photo.jpg -w 1200 -h 630
```

Dimensions: 1200 × 630 (1.91:1 ratio)

#### Twitter / X

```bash
# Twitter card images
mediaproc image smart-crop photo.jpg -w 1024 -h 512
```

Dimensions: 1024 × 512 (2:1 ratio)

#### Instagram Square

```bash
# Instagram square posts
mediaproc image smart-crop photo.jpg -w 1080 -h 1080
```

Dimensions: 1080 × 1080 (1:1 ratio)

#### Instagram Stories

```bash
# Vertical stories/reels
mediaproc image smart-crop photo.jpg -w 1080 -h 1920
```

Dimensions: 1080 × 1920 (9:16 ratio)

### Web & General

#### Thumbnails

```bash
# Square thumbnails
mediaproc image smart-crop photo.jpg -w 800 -h 800
```

Dimensions: 800 × 800

#### Full HD

```bash
# Desktop wallpaper / banners
mediaproc image smart-crop photo.jpg -w 1920 -h 1080
```

Dimensions: 1920 × 1080 (16:9 ratio)

#### Profile Pictures

```bash
# Avatar / profile pics
mediaproc image smart-crop photo.jpg -w 512 -h 512
```

Dimensions: 512 × 512

## Basic Examples

### Entropy Cropping (Default)

Crop landscape to Facebook dimensions:

```bash
mediaproc image smart-crop landscape.jpg -w 1200 -h 630
```

Output: `landscape-cropped.jpg` (1200 × 630)

### Attention Cropping

Crop portrait to Instagram square:

```bash
mediaproc image smart-crop portrait.jpg -w 1080 -h 1080 -s attention
```

Output: `portrait-cropped.jpg` (1080 × 1080)

### Custom Output

Specify output path:

```bash
mediaproc image smart-crop photo.jpg -w 800 -h 800 -o thumbnail.jpg
```

Output: `thumbnail.jpg` (800 × 800)

### Verbose Mode

See processing details:

```bash
mediaproc image smart-crop image.jpg -w 1920 -h 1080 -v
```

Output:

```
Processing: image.jpg
Strategy: entropy
Target dimensions: 1920 × 1080
✓ image.jpg smart cropped

Summary:
  ✓ Success: 1
```

## Social Media Examples

### Facebook Post

Crop for Facebook shared posts:

```bash
mediaproc image smart-crop blog-photo.jpg -w 1200 -h 630 -s entropy
```

Creates: `blog-photo-cropped.jpg` (1200 × 630)

- Preserves important details
- Optimized for Facebook sharing
- Works for LinkedIn too

### Twitter Card

Crop for Twitter card image:

```bash
mediaproc image smart-crop article.jpg -w 1024 -h 512 -s entropy
```

Creates: `article-cropped.jpg` (1024 × 512)

- 2:1 aspect ratio
- Perfect for Twitter cards
- Preserves key content

### Instagram Square

Crop for Instagram feed:

```bash
mediaproc image smart-crop photo.jpg -w 1080 -h 1080 -s attention
```

Creates: `photo-cropped.jpg` (1080 × 1080)

- Square format
- Centered subject preserved
- Ready for Instagram

### Instagram Story

Crop for vertical story:

```bash
mediaproc image smart-crop photo.jpg -w 1080 -h 1920 -s attention
```

Creates: `photo-cropped.jpg` (1080 × 1920)

- 9:16 vertical format
- Perfect for stories/reels
- Subject stays centered

### Batch Social Media

Prepare for all platforms:

```bash
# Facebook
mediaproc image smart-crop photo.jpg -w 1200 -h 630 -o fb-photo.jpg

# Twitter
mediaproc image smart-crop photo.jpg -w 1024 -h 512 -o twitter-photo.jpg

# Instagram square
mediaproc image smart-crop photo.jpg -w 1080 -h 1080 -o insta-photo.jpg -s attention

# Instagram story
mediaproc image smart-crop photo.jpg -w 1080 -h 1920 -o story-photo.jpg -s attention
```

## Product Photography

### Product Thumbnails

Create consistent product thumbnails:

```bash
# Square thumbnails for e-commerce
mediaproc image smart-crop product.jpg -w 800 -h 800 -s attention
```

Perfect for:

- E-commerce listings
- Product galleries
- Shopping feeds
- Catalog images

### Product Detail

Crop to detail view:

```bash
# Preserve product details
mediaproc image smart-crop product-detail.jpg -w 1200 -h 1200 -s entropy
```

Great for:

- Zoomed product views
- Texture details
- Feature highlights
- Close-up shots

### Batch Product Processing

```bash
# Process all product images
for img in products/*.jpg; do
  mediaproc image smart-crop "$img" -w 800 -h 800 -s attention
done
```

## Blog & Content

### Featured Images

Crop for blog post headers:

```bash
# Blog featured image
mediaproc image smart-crop article-photo.jpg -w 1200 -h 630 -o featured.jpg
```

Ideal for:

- Blog post headers
- Article previews
- Content thumbnails
- Newsletter images

### Blog Thumbnails

Create smaller thumbnails:

```bash
# Thumbnail for blog list
mediaproc image smart-crop article.jpg -w 400 -h 250 -o thumb.jpg
```

Perfect for:

- Blog post lists
- Archive pages
- Category views
- Related posts

### Content Gallery

Uniform gallery images:

```bash
# Square gallery images
mediaproc image smart-crop gallery/*.jpg -w 600 -h 600 -s entropy
```

Creates:

- Consistent gallery layout
- Uniform dimensions
- Professional appearance

## Profile & Avatar

### Profile Pictures

Crop for profile images:

```bash
# Square profile picture
mediaproc image smart-crop headshot.jpg -w 512 -h 512 -s attention
```

Output: `headshot-cropped.jpg` (512 × 512)

- Centered on face
- Consistent sizing
- Ready for avatars

### Team Photos

Batch process team photos:

```bash
# Process all headshots
for img in team/*.jpg; do
  mediaproc image smart-crop "$img" -w 400 -h 400 -s attention -o "team-cropped/$(basename $img)"
done
```

Creates:

- Uniform team photos
- Consistent dimensions
- Professional gallery

### Multiple Sizes

Create various profile sizes:

```bash
# Large
mediaproc image smart-crop photo.jpg -w 512 -h 512 -o profile-large.jpg -s attention

# Medium
mediaproc image smart-crop photo.jpg -w 256 -h 256 -o profile-medium.jpg -s attention

# Small
mediaproc image smart-crop photo.jpg -w 128 -h 128 -o profile-small.jpg -s attention
```

## Website Images

### Hero Banners

Crop for hero sections:

```bash
# Full HD banner
mediaproc image smart-crop hero.jpg -w 1920 -h 1080 -s entropy
```

Perfect for:

- Homepage heroes
- Section headers
- Landing pages
- Full-width banners

### Card Images

Crop for content cards:

```bash
# Card thumbnail
mediaproc image smart-crop card-image.jpg -w 400 -h 300 -s entropy
```

Ideal for:

- Content cards
- Grid layouts
- Feature sections
- Preview images

### Background Images

Crop for backgrounds:

```bash
# Wide background
mediaproc image smart-crop bg.jpg -w 1920 -h 600 -s entropy
```

Great for:

- Section backgrounds
- Header images
- Page backgrounds
- Full-width sections

## Mobile App

### App Screenshots

Crop for app stores:

```bash
# iPhone screenshot
mediaproc image smart-crop screenshot.jpg -w 1242 -h 2208 -s attention

# iPad screenshot
mediaproc image smart-crop screenshot.jpg -w 2048 -h 2732 -s attention
```

### App Assets

Various app image needs:

```bash
# Feature graphic
mediaproc image smart-crop feature.jpg -w 1024 -h 500

# Promo image
mediaproc image smart-crop promo.jpg -w 1440 -h 900
```

## Advanced Examples

### Strategy Comparison

Compare both strategies:

```bash
# Try entropy strategy
mediaproc image smart-crop photo.jpg -w 1200 -h 630 -o photo-entropy.jpg -s entropy

# Try attention strategy
mediaproc image smart-crop photo.jpg -w 1200 -h 630 -o photo-attention.jpg -s attention

# Compare results
```

### Batch Processing

Process entire directory:

```bash
# Entropy strategy for all
for img in photos/*.jpg; do
  mediaproc image smart-crop "$img" -w 1080 -h 1080
done
```

### Custom Script

```bash
#!/bin/bash
# Social media batch processor

INPUT_DIR="originals"
OUTPUT_DIR="social"

mkdir -p "$OUTPUT_DIR"

for img in "$INPUT_DIR"/*.jpg; do
  basename=$(basename "$img" .jpg)

  # Facebook
  mediaproc image smart-crop "$img" -w 1200 -h 630 -o "$OUTPUT_DIR/${basename}-fb.jpg"

  # Twitter
  mediaproc image smart-crop "$img" -w 1024 -h 512 -o "$OUTPUT_DIR/${basename}-tw.jpg"

  # Instagram
  mediaproc image smart-crop "$img" -w 1080 -h 1080 -o "$OUTPUT_DIR/${basename}-ig.jpg" -s attention

  echo "Processed: $basename"
done

echo "Complete! Check $OUTPUT_DIR/"
```

### Parallel Processing

```bash
# Use GNU parallel for speed
parallel mediaproc image smart-crop {} -w 1200 -h 630 ::: photos/*.jpg
```

### Chain Commands

Combine with other operations:

```bash
# Smart crop then optimize
mediaproc image smart-crop photo.jpg -w 1200 -h 630
mediaproc image optimize photo-cropped.jpg -q 85

# Smart crop then sharpen
mediaproc image smart-crop product.jpg -w 800 -h 800
mediaproc image sharpen product-cropped.jpg

# Smart crop then watermark
mediaproc image smart-crop blog.jpg -w 1200 -h 630
mediaproc image watermark blog-cropped.jpg -t "Blog Post" -p southeast
```

## Use Cases

### E-commerce Platform

```bash
# Create product thumbnails
mediaproc image smart-crop product-photos/*.jpg -w 800 -h 800 -s attention

# Create listing images
mediaproc image smart-crop product-photos/*.jpg -w 1200 -h 1200 -s entropy
```

### Blog Publishing

```bash
# Featured images
mediaproc image smart-crop article-photo.jpg -w 1200 -h 630 -o featured.jpg

# Thumbnail
mediaproc image smart-crop article-photo.jpg -w 400 -h 250 -o thumb.jpg

# Social sharing
mediaproc image smart-crop article-photo.jpg -w 1024 -h 512 -o social.jpg
```

### Social Media Manager

```bash
# Prepare content for all platforms
BASE="campaign-photo.jpg"

# Facebook/LinkedIn
mediaproc image smart-crop "$BASE" -w 1200 -h 630 -o fb.jpg

# Twitter
mediaproc image smart-crop "$BASE" -w 1024 -h 512 -o twitter.jpg

# Instagram feed
mediaproc image smart-crop "$BASE" -w 1080 -h 1080 -o instagram.jpg -s attention

# Instagram story
mediaproc image smart-crop "$BASE" -w 1080 -h 1920 -o story.jpg -s attention
```

### Photography Portfolio

```bash
# Create consistent gallery
for img in portfolio/*.jpg; do
  # Preserve details with entropy
  mediaproc image smart-crop "$img" -w 1200 -h 800 -s entropy
done
```

## Strategy Selection Guide

### Use Entropy When:

- Image has details throughout (landscapes, cityscapes)
- No clear subject in center
- Want to preserve textures and patterns
- Complex compositions with multiple focal points
- Nature and architectural photography
- Abstract or detailed imagery

### Use Attention When:

- Clear centered subject (portraits, products)
- Subject is in center of frame
- Want to keep focus on main subject
- Profile pictures and headshots
- Product photography
- Centered compositions

### Examples:

**Entropy**:

```bash
# Landscape with details everywhere
mediaproc image smart-crop landscape.jpg -w 1200 -h 630 -s entropy

# Urban scene with multiple buildings
mediaproc image smart-crop cityscape.jpg -w 1920 -h 1080 -s entropy

# Texture or pattern image
mediaproc image smart-crop texture.jpg -w 800 -h 800 -s entropy
```

**Attention**:

```bash
# Portrait with centered face
mediaproc image smart-crop portrait.jpg -w 1080 -h 1080 -s attention

# Product photo with centered product
mediaproc image smart-crop product.jpg -w 800 -h 800 -s attention

# Logo or icon
mediaproc image smart-crop logo.jpg -w 512 -h 512 -s attention
```

## Best Practices

### Source Image Size

- Works best when source is larger than target
- Minimum recommended: 1.5× target dimensions
- Larger source = better cropping options
- Very small sources may not crop well

### Aspect Ratio

- Target ratio doesn't need to match source
- Algorithm handles any aspect ratio conversion
- Consider final use when choosing dimensions
- Portrait to landscape (and vice versa) works fine

### Quality

- Use high-quality source images
- Cropping doesn't improve quality
- Sharp, well-lit sources work best
- Consider optimizing after cropping

### Testing

- Try both strategies to see which works better
- Compare results for important images
- Test on sample before batch processing
- Adjust strategy based on subject matter

### File Organization

- Keep originals separate from cropped versions
- Use descriptive output names
- Organize by platform or use case
- Consider subfolder structure

## Output Naming

Default pattern: `{basename}-cropped.{ext}`

```bash
# Examples
photo.jpg → photo-cropped.jpg
image.png → image-cropped.png
product.jpg → product-cropped.jpg
```

Custom output:

```bash
mediaproc image smart-crop photo.jpg -w 1200 -h 630 -o facebook-post.jpg
```

Organized output:

```bash
# Output to specific directories
mediaproc image smart-crop photo.jpg -w 1200 -h 630 -o social/facebook/photo.jpg
mediaproc image smart-crop photo.jpg -w 1080 -h 1080 -o social/instagram/photo.jpg
```

## Performance

Processing time depends on:

- Source image size
- Target dimensions
- Strategy complexity
- System performance

Typical processing times:

- Small (< 1MP): ~50-100ms
- Medium (1-4MP): ~100-200ms
- Large (4-10MP): ~200-500ms
- Very large (> 10MP): ~500ms-1s

Both strategies have similar performance.

## Technical Implementation

Uses Sharp's `resize()` with content-aware options:

```typescript
await sharp(input)
  .resize(width, height, {
    fit: "cover", // Crop to fill dimensions
    position: strategy, // 'entropy' or 'attention'
  })
  .toFile(output);
```

**Fit: cover**:

- Crops image to exactly fill dimensions
- Maintains aspect ratio of target
- No distortion or stretching

**Position: entropy**:

- Analyzes image for edge density
- Preserves high-information areas
- Smart detail preservation

**Position: attention**:

- Center-weighted positioning
- Keeps central subjects in frame
- Best for centered compositions

## Troubleshooting

### Important Content Cropped

**Issue**: Key content is cut off

**Solutions**:

```bash
# Try different strategy
mediaproc image smart-crop photo.jpg -w 1200 -h 630 -s attention  # if used entropy
mediaproc image smart-crop photo.jpg -w 1200 -h 630 -s entropy    # if used attention

# Adjust target dimensions
mediaproc image smart-crop photo.jpg -w 1200 -h 800  # taller crop

# Use regular crop with manual positioning
mediaproc image crop photo.jpg -w 1200 -h 630 -x 100 -y 200
```

### Image Too Small

**Issue**: Source image smaller than target dimensions

**Error**: Image will be upscaled (not recommended)

**Solution**:

```bash
# Check source dimensions first
mediaproc image stats photo.jpg

# Use appropriate target size
# If source is 800×600, don't crop to 1920×1080
```

### Poor Results

**Issue**: Cropping doesn't look good

**Solutions**:

1. Try both strategies
2. Adjust target dimensions
3. Use higher quality source
4. Consider manual crop instead

### Strategy Confusion

**Issue**: Not sure which strategy to use

**Solution**: Try both!

```bash
# Generate both versions
mediaproc image smart-crop photo.jpg -w 1200 -h 630 -o entropy.jpg -s entropy
mediaproc image smart-crop photo.jpg -w 1200 -h 630 -o attention.jpg -s attention

# Compare and choose best
```

## Related Commands

- `crop` - Manual cropping with exact coordinates
- `resize` - Resize images with various fit options
- `thumbnail` - Generate thumbnails with smart cropping
- `extract` - Extract specific regions
- `trim` - Remove border space

## See Also

- [Crop](/plugins/image/crop) - Manual cropping
- [Resize](/plugins/image/resize) - Image resizing
- [Thumbnail](/plugins/image/thumbnail) - Thumbnail generation
- [Social Media Guide](/guides/social-media) - Social media image specs
- [Content Strategy](/guides/content-strategy) - Image content best practices
